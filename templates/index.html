<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>MedAware - Drug Interaction Checker</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { padding: 20px; }
        img { max-width: 100px; }
        .filter-bar { margin-bottom: 20px; }
        
        /* Make the Interactions column scrollable */
        .scrollable-column {
            max-height: 300px;
            overflow-y: auto;
            display: block;
            width: 200px;
        }
    </style>
</head>
<body>
    <h1 class="mb-4">MedAware - Drug Interaction Checker</h1>
    <form class="filter-bar row g-2" method="get">
        <div class="col-md-3">
            <input type="text" name="query" class="form-control" placeholder="Search medicine..." value="{{ request.args.get('query', '') }}">
        </div>
        <div class="col-md-3">
            <input type="text" name="use" class="form-control" placeholder="Filter by use..." value="{{ request.args.get('use', '') }}">
        </div>
        <div class="col-md-3">
            <input type="text" name="side" class="form-control" placeholder="Filter by side effects..." value="{{ request.args.get('side', '') }}">
        </div>
        <div class="col-md-3">
            <button type="submit" class="btn btn-primary">Apply Filters</button>
        </div>
    </form>
    <table class="table table-bordered table-hover">
        <thead class="table-dark">
            <tr>
                <th>Image</th>
                <th>Name</th>
                <th>Composition</th>
                <th>Uses</th>
                <th>Side Effects</th>
                <th>Interactions</th>
                <th>Reviews</th>
            </tr>
        </thead>
        <tbody>
            {% for row in data %}
            <tr>
                <td><img src="{{ row['Image URL'] }}" alt="Image"></td>
                <td>{{ row['Medicine Name'] }}</td>
                <td>{{ row['Composition'] }}</td>
                <td>{{ row['Uses'] }}</td>
                <td>{{ row['Side_effects'] }}</td>
                <td class="scrollable-column">
                    <button class="btn btn-sm btn-outline-primary" data-composition="{{ row['Composition'] | e }}" onclick="loadInteractions(this)">Show Interactions</button>
                    <div class="interactions mt-2" style="display:none;"></div>
                </td>                
                <td>
                    üëç {{ row['Excellent Review %'] }}%<br>
                    üòê {{ row['Average Review %'] }}%<br>
                    üëé {{ row['Poor Review %'] }}%
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    
</body>
</html>

<script>
    function loadInteractions(buttonElement) {
        const composition = buttonElement.dataset.composition;

        fetch('/interactions', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ composition: composition })
        })
        .then(response => response.json())
        .then(data => {
            const interactionsDiv = buttonElement.nextElementSibling;
            interactionsDiv.innerHTML = '';

            if (data.interactions && data.interactions.length > 0) {
                const list = document.createElement('ul');
                data.interactions.forEach(interaction => {
                    const li = document.createElement('li');
                    li.textContent = interaction;
                    list.appendChild(li);
                });
                interactionsDiv.appendChild(list);
            } else {
                interactionsDiv.textContent = 'No interactions found';
            }

            interactionsDiv.style.display = 'block';
            buttonElement.remove();  // Optional: remove button after loading
        })
        .catch(error => {
            console.error('Error loading interactions:', error);
        });
    }
</script>

    
    